#column_to_file.py

import pandas as pd

def extract_from_sheet(df, target_col, filter_col, to_remove):
  df.columns = df.columns.str.strip().str.lower()
  mask = df[filter_col].fillna('').astype(str).str.lower() != to_remove
  return df.loc[mask, target_col].astype(str).tolist()

def process_all_targets(input_file, output_dir, targets, target_col, filter_col, to_remove):
  with pd.ExcelFile(input_file) as xls:
    for sheet_name, output_filename in targets.items():
      if sheet_name in xls.sheet_names:
        df = pd.read_excel(xls, sheet_name=sheet_name)
        filtered_values = extract_from_sheet(df, target_col, filter_col, to_remove)
        output_path = output_dir+output_filename
        write_to_file(output_path, filtered_values)
        print(f"completed col to file for: {sheet_name} -> {output_path}")
      else:
        print(f"Warning: Sheet '{sheet_name}' not found in {input_file}")

def write_to_file(output_filename, filtered_values):
  out_string = " ".join(filtered_values)
  with open(output_filename, "w", encoding="utf-8") as f:
    f.write(out_string)

def main():
  input_path = "j:/tmp/vad/prod/combined.xlsx"
  output_dir = "j:/tmp/vad/prod/all/"
  targets = {
    "Triton - Hamilton": "call_hamilton_triton.txt",
    "Vllm - Hamilton": "call_hamilton_vllm.txt",
    "Triton - alternate": "call_alternate_triton.txt",
    "Vllm - alternate": "call_alternate_vllm.txt",
    "Triton - Hamilton1": "call_hamilton1_triton.txt",
    "Vllm - Hamilton1": "call_hamilton1_vllm.txt",
  }
  target_col = "transcript"
  filter_col = "speaker"
  to_remove = "none"

  process_all_targets(input_path, output_dir, targets, target_col, filter_col, to_remove)

if __name__ == "__main__":
  main()