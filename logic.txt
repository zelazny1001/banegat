# launcher.py
import sys, subprocess, time

SCRIPT_ROOT = "/projects/root/"
SCRIPT = SCRIPT_ROOT + "local_voice_gateway_simulator_2.py"
NUM_INSTANCES = 1
CREATE_NO_WINDOW = 0x08000000

start_time = time.time()

# 1) launch all
procs = {}
for i in range(1, NUM_INSTANCES + 1):
    p = subprocess.Popen(
        [sys.executable, SCRIPT],
        creationflags=CREATE_NO_WINDOW
    )
    print(f"[{i}/{NUM_INSTANCES}] Launched PID={p.pid}")
    procs[i] = p

# 2) poll & report
remaining = set(procs)
completed = 0

while remaining:
    for i in list(remaining):
        p = procs[i]
        if p.poll() is not None:            # itâ€™s done
            completed += 1
            elapsed = time.time() - start_time
            print(f"[{completed}/{NUM_INSTANCES}] Elapsed: {elapsed:.2f}s")
            remaining.remove(i)
    time.sleep(0.2)

print("All instances completed.")